<flow name="upsert_records_in_batchesFlow">
    <http:listener doc:name="Listener" doc:id="c8cf25f2-2bbc-43a0-93a9-45883afe5f91" config-ref="HTTP_Listener_config" path="/upsertRecords"/>
    <ee:transform doc:name="Transform Message" doc:id="b9f04e78-c9b1-45b1-935f-266c7843220a" >
        <!-- Your existing transformation logic for a single record -->
    </ee:transform>
    <foreach collection="#[dw('vars.Allrecords') groupBy ((item, index) -> (index / 200) as :string)]" doc:name="For Each Batch">
        <ee:transform doc:name="Transform Batch">
            <ee:set-payload><![CDATA[%dw 2.0
                output application/json 
                ---
                $.values[$$ as Number]  // Select each batch of up to 200 records
            ]]</ee:set-payload>
        </ee:transform>
        <salesforce:upsert doc:name="Upsert" doc:id="65b61484-e646-4d0f-870a-902dbb053438" config-ref="Salesforce_Config" externalIdFieldName="AuraComponents__studentId__c" objectType="Contact">
            <salesforce:records ><![CDATA[#[payload]]]></salesforce:records>
        </salesforce:upsert>
        <ee:transform doc:name="Transform Message" doc:id="83910fc4-505e-4c8d-82e1-9b3d54b471f5" >
            <!-- Your existing error handling logic for the batch -->
        </ee:transform>
    </foreach>
    <ee:transform doc:name="Transform Message" doc:id="bc6dd161-350c-4f84-a060-36d498d506f6">
        <!-- Your final transformation logic for the response -->
    </ee:transform>
</flow>






